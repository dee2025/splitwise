"use client\";\n\nimport { logout } from \"@/redux/slices/authSlice\";\nimport axios from \"axios\";\nimport { AnimatePresence, motion } from \"framer-motion\";\nimport {\n  Bell,\n  Menu,\n  X,\n  LogOut,\n  Settings,\n  User,\n  Users,\n  Home,\n  IndianRupee,\n  ChevronDown,\n} from \"lucide-react\";\nimport Link from \"next/link\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { useEffect, useRef, useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport NotificationBell from \"./NotificationBell\";\n\nexport default function Navbar() {\n  const dispatch = useDispatch();\n  const router = useRouter();\n  const pathname = usePathname();\n  const { user, isAuthenticated } = useSelector((state) => state.auth);\n\n  const [showUserMenu, setShowUserMenu] = useState(false);\n  const [showMobileMenu, setShowMobileMenu] = useState(false);\n  const userMenuRef = useRef(null);\n  const mobileMenuRef = useRef(null);\n\n  const navItems = [\n    { name: \"Dashboard\", icon: Home, path: \"/dashboard\" },\n    { name: \"Groups\", icon: Users, path: \"/groups\" },\n    { name: \"Expenses\", icon: IndianRupee, path: \"/expenses\" },\n  ];\n\n  const handleLogout = async () => {\n    try {\n      await axios.post(\"/api/auth/logout\");\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    } finally {\n      dispatch(logout());\n      toast.success(\"Logged out successfully\");\n      router.push(\"/\");\n    }\n  };\n\n  // Close dropdowns when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (userMenuRef.current && !userMenuRef.current.contains(event.target)) {\n        setShowUserMenu(false);\n      }\n      if (\n        mobileMenuRef.current &&\n        !mobileMenuRef.current.contains(event.target)\n      ) {\n        setShowMobileMenu(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  return (\n    <header className=\"sticky top-0 z-40 bg-white/95 backdrop-blur-lg border-b border-gray-200 shadow-sm\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-4\">\n        <div className=\"flex items-center justify-between gap-4\">\n          {/* Logo */}\n          <Link href=\"/dashboard\" className=\"flex items-center gap-2 shrink-0\">\n            <div className=\"w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold text-lg shadow-lg\">\n              S\n            </div>\n            <span className=\"text-xl font-bold hidden sm:inline\">\n              Split<span className=\"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">Wise</span>\n            </span>\n          </Link>\n\n          {/* Desktop Navigation */}\n          <nav className=\"hidden md:flex items-center gap-1\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = pathname.startsWith(item.path);\n              return (\n                <Link\n                  key={item.path}\n                  href={item.path}\n                  className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all duration-200 font-medium text-sm ${\n                    isActive\n                      ? \"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg\"\n                      : \"text-gray-700 hover:bg-gray-100\"\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  {item.name}\n                </Link>\n              );\n            })}\n          </nav>\n\n          {/* Right Section */}\n          <div className=\"flex items-center gap-2 sm:gap-4\">\n            {/* Notifications */}\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              className=\"p-2 rounded-lg hover:bg-gray-100 text-gray-700 transition-colors duration-200 relative\"\n            >\n              <NotificationBell />\n            </motion.button>\n\n            {/* User Menu - Desktop */}\n            <div ref={userMenuRef} className=\"relative hidden sm:block\">\n              <motion.button\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.95 }}\n                onClick={() => setShowUserMenu(!showUserMenu)}\n                className=\"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors duration-200\"\n              >\n                <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center text-white font-semibold text-sm\">\n                  {user?.fullName?.charAt(0).toUpperCase() ?? \"?\"}\n                </div>\n                <span className=\"hidden md:inline text-sm font-medium text-gray-700\">\n                  {user?.fullName?.split(\" \")[0]}\n                </span>\n                <ChevronDown\n                  className={`w-4 h-4 text-gray-600 transition-transform duration-200 ${\n                    showUserMenu ? \"rotate-180\" : \"\"\n                  }`}\n                />\n              </motion.button>\n\n              {/* User Dropdown */}\n              <AnimatePresence>\n                {showUserMenu && (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10, scale: 0.95 }}\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: -10, scale: 0.95 }}\n                    transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n                    className=\"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-lg border border-gray-100 divide-y divide-gray-100 z-50\"\n                  >\n                    {/* User Info */}\n                    <div className=\"p-4 bg-gradient-to-r from-blue-50 to-purple-50\">\n                      <p className=\"text-sm font-bold text-gray-900\">\n                        {user?.fullName}\n                      </p>\n                      <p className=\"text-xs text-gray-600\">@{user?.username}</p>\n                    </div>\n\n                    {/* Menu Items */}\n                    <div className=\"py-2\">\n                      {[\n                        { icon: User, label: \"View Profile\", action: () => router.push(\"/profile\") },\n                        { icon: Settings, label: \"Settings\", action: () => router.push(\"/profile\") },\n                      ].map((item, idx) => {\n                        const Icon = item.icon;\n                        return (\n                          <motion.button\n                            key={idx}\n                            onClick={() => {\n                              item.action();\n                              setShowUserMenu(false);\n                            }}\n                            whileHover={{ backgroundColor: \"#f3f4f6\" }}\n                            className=\"w-full px-4 py-2.5 flex items-center gap-3 text-gray-700 hover:text-blue-600 transition-colors duration-200 text-sm\"\n                          >\n                            <Icon className=\"w-4 h-4\" />\n                            {item.label}\n                          </motion.button>\n                        );\n                      })}\n                    </div>\n\n                    {/* Logout */}\n                    <div className=\"p-2\">\n                      <motion.button\n                        onClick={() => {\n                          handleLogout();\n                          setShowUserMenu(false);\n                        }}\n                        whileHover={{ backgroundColor: \"#fef2f2\" }}\n                        className=\"w-full px-4 py-2.5 flex items-center gap-3 text-red-600 hover:text-red-700 transition-colors duration-200 text-sm font-medium rounded-lg\"\n                      >\n                        <LogOut className=\"w-4 h-4\" />\n                        Logout\n                      </motion.button>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n\n            {/* Mobile Menu Toggle */}\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => setShowMobileMenu(!showMobileMenu)}\n              className=\"md:hidden p-2 rounded-lg hover:bg-gray-100 text-gray-700 transition-colors duration-200\"\n            >\n              {showMobileMenu ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\n            </motion.button>\n          </div>\n        </div>\n\n        {/* Mobile Navigation Menu */}\n        <AnimatePresence>\n          {showMobileMenu && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              exit={{ opacity: 0, height: 0 }}\n              transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n              className=\"md:hidden mt-4 pt-4 border-t border-gray-200 divide-y divide-gray-100\"\n            >\n              {/* Nav Items */}\n              <div className=\"pb-3 space-y-2\">\n                {navItems.map((item) => {\n                  const Icon = item.icon;\n                  const isActive = pathname.startsWith(item.path);\n                  return (\n                    <Link\n                      key={item.path}\n                      href={item.path}\n                      onClick={() => setShowMobileMenu(false)}\n                      className={`block px-4 py-2 rounded-lg flex items-center gap-3 transition-all duration-200 font-medium ${\n                        isActive\n                          ? \"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg\"\n                          : \"text-gray-700 hover:bg-gray-100\"\n                      }`}\n                    >\n                      <Icon className=\"w-5 h-5\" />\n                      {item.name}\n                    </Link>\n                  );\n                })}\n              </div>\n\n              {/* User Menu - Mobile */}\n              <div className=\"pt-3 space-y-2\">\n                <button\n                  onClick={() => {\n                    router.push(\"/profile\");\n                    setShowMobileMenu(false);\n                  }}\n                  className=\"w-full text-left px-4 py-2 rounded-lg flex items-center gap-3 text-gray-700 hover:bg-gray-100 transition-colors duration-200\"\n                >\n                  <User className=\"w-5 h-5\" />\n                  Profile\n                </button>\n                <button\n                  onClick={() => {\n                    handleLogout();\n                    setShowMobileMenu(false);\n                  }}\n                  className=\"w-full text-left px-4 py-2 rounded-lg flex items-center gap-3 text-red-600 hover:bg-red-50 transition-colors duration-200 font-medium\"\n                >\n                  <LogOut className=\"w-5 h-5\" />\n                  Logout\n                </button>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </header>\n  );\n}\n